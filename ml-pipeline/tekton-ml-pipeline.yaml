---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: data-fetch
spec:
  steps:
  - name: run-data-fetch
    image: juanlugodev/data-fetch:latest
    env:
      - name: MINIO_URL
        value: "minio-service.default.svc.cluster.local:9000"
      - name: MINIO_ACCESS_KEY
        value: "admin"
      - name: MINIO_SECRET_KEY
        value: "password"
    script: |
      #!/bin/sh
      echo "Running data fetch..."
      python data_fetch.py
      echo "Data fetch completed."
---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: data-ingestion
spec:
  steps:
  - name: run-data-ingestion
    image: juanlugodev/data-ingestion:latest
    env:
      - name: MINIO_URL
        value: "minio-service.default.svc.cluster.local:9000"
      - name: MINIO_ACCESS_KEY
        value: "admin"
      - name: MINIO_SECRET_KEY
        value: "password"
    script: |
      #!/bin/sh
      echo "Running data ingestion..."
      python data_ingestion.py
      echo "Data ingestion completed."
---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: model-training
spec:
  steps:
  - name: run-model-training
    image: juanlugodev/model-training:latest
    env:
      - name: MINIO_URL
        value: "minio-service.default.svc.cluster.local:9000"
      - name: MINIO_ACCESS_KEY
        value: "admin"
      - name: MINIO_SECRET_KEY
        value: "password"
    script: |
      #!/bin/sh
      echo "Running model training..."
      python model_training.py
      echo "Model training completed."
---
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: ml-pipeline
spec:
  tasks:
  - name: fetch
    taskRef:
      name: data-fetch
    retries: 2
  - name: ingest
    runAfter:
      - fetch
    taskRef:
      name: data-ingestion
    retries: 2
  - name: train
    runAfter:
      - ingest
    taskRef:
      name: model-training
    retries: 2
---
apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  name: ml-pipeline-run
spec:
  pipelineRef:
    name: ml-pipeline
 